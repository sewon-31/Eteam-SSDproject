<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>test_shell.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿#include "test_shell.h"
#include "command_parser.h"
#include &lt;iostream&gt;

using std::cout;
bool TestShell::ExecuteCommand(vector&lt;string&gt; commandVector)
<span style = "background-color:#dfd">{
    std::string opCommand = commandVector.at(0);</span>

<span style = "background-color:#dfd">    if (opCommand == CommandParser::CMD_EXIT) {</span>
<span style = "background-color:#fdd">        return false;
    }</span>
<span style = "background-color:#dfd">    else if (opCommand == CommandParser::CMD_HELP) {
        help();
    }
    else if (opCommand == CommandParser::CMD_WRITE) {
        int lba = std::stoi(commandVector.at(1));
        std::string value = commandVector.at(2);
        std::cout &lt;&lt; "Executing write to LBA " &lt;&lt; lba &lt;&lt; " with value " &lt;&lt; value &lt;&lt; std::endl;
        write(lba, value);
    }
    else if (opCommand == CommandParser::CMD_READ) {
        int lba = std::stoi(commandVector.at(1));
        std::cout &lt;&lt; "Executing read from LBA " &lt;&lt; lba &lt;&lt; std::endl;
        read(lba);
    }
    else if (opCommand == CommandParser::CMD_FULLWRITE) {
        std::string value = commandVector.at(1);
        std::cout &lt;&lt; "Executing fullwrite with value " &lt;&lt; value &lt;&lt; std::endl;
        fullWrite(value);
    }
    else if (opCommand == CommandParser::CMD_FULLREAD) {
        std::cout &lt;&lt; "Executing fullread" &lt;&lt; std::endl;
        fullRead();
    }</span>
<span style = "background-color:#fdd">    else if (opCommand == CommandParser::CMD_SCRIPT1 || opCommand == CommandParser::CMD_SCRIPT1_NAME) {
        std::cout &lt;&lt; "Running script 1: FullWriteAndReadCompare" &lt;&lt; std::endl;</span>
        // TestScript1::Run();
<span style = "background-color:#fdd">    }
    else if (opCommand == CommandParser::CMD_SCRIPT2 || opCommand == CommandParser::CMD_SCRIPT2_NAME) {
        std::cout &lt;&lt; "Running script 2: PartialLBAWrite" &lt;&lt; std::endl;</span>
        // TestScript2::Run();
<span style = "background-color:#fdd">    }
    else if (opCommand == CommandParser::CMD_SCRIPT3 || opCommand == CommandParser::CMD_SCRIPT3_NAME) {
        std::cout &lt;&lt; "Running script 3: WriteReadAging" &lt;&lt; std::endl;</span>
        // TestScript3::writeReadAging();
<span style = "background-color:#fdd">    }</span>
    else {
<span style = "background-color:#fdd">        std::cout &lt;&lt; "[Error] Unknown command: " &lt;&lt; opCommand &lt;&lt; std::endl;</span>
    }

<span style = "background-color:#dfd">    return true;
}</span>

void TestShell::runShell()
<span style = "background-color:#fdd">{
    std::string inputLine;</span>

<span style = "background-color:#fdd">    while (true) {
        std::cout &lt;&lt; "shell &gt; ";
        std::getline(std::cin, inputLine);</span>

<span style = "background-color:#fdd">        if (inputLine.empty()) continue;</span>

<span style = "background-color:#fdd">        commandParser.setCommand(inputLine);</span>

<span style = "background-color:#fdd">        if (!commandParser.isValidCommand()) {
            std::cout &lt;&lt; "[Error] Invalid command or arguments." &lt;&lt; std::endl;
            continue;</span>
        }

<span style = "background-color:#fdd">        if (false == ExecuteCommand(commandParser.getCommandVector())) return;
    }
}</span>

<span style = "background-color:#dfd">void TestShell::read(int lba) {</span>

    try {
<span style = "background-color:#dfd">        ssdReadAndPrint(lba);</span>
    }
<span style = "background-color:#dfd">    catch(std::exception e){
        cout &lt;&lt; string(e.what());
    }
}</span>

void TestShell::fullRead()
<span style = "background-color:#dfd">{</span>
    try {
<span style = "background-color:#dfd">	    for (int addr = 0; addr &lt; MAX_LBA; addr++) {       
            ssdReadAndPrint(addr);
	    }</span>
    }
<span style = "background-color:#dfd">    catch (std::exception e) {
        cout &lt;&lt; string(e.what());
    }
}</span>

void TestShell::ssdReadAndPrint(int addr)
<span style = "background-color:#dfd">{
    std::string content = ssd-&gt;read(addr);
    std::ostringstream oss;
    oss &lt;&lt; std::setw(2) &lt;&lt; std::setfill('0') &lt;&lt; addr;</span>

<span style = "background-color:#dfd">    cout &lt;&lt; READ_HEADER &lt;&lt; oss.str() &lt;&lt; READ_MIDFIX &lt;&lt; content &lt;&lt; READ_FOOTER;
}</span>


<span style = "background-color:#dfd">void TestShell::write(int lba, std::string value) {
	if (ssd == nullptr) return;
	if (lba &gt;= 100 || lba &lt; 0)
		return;
	ssd-&gt;write(lba, value);
	std::cout &lt;&lt; "[WRITE] Done" &lt;&lt; std::endl;
}</span>

<span style = "background-color:#dfd">void TestShell::fullWrite(std::string value) {
	for (int i = 0; i &lt; 100; i++)
		ssd-&gt;write(i, value);
}</span>

<span style = "background-color:#dfd">void TestShell::help() {
	std::cout &lt;&lt; "Team: Easiest\n";
	std::cout &lt;&lt; "Member: Sewon Joo, Dokyeong Kim, Nayoung Yoon, Seungah Lim, Jaeyeong Jeon, Insang Cho, Dooyeun Hwang\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "Available commands:\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "\twrite &lt;address&gt; &lt;value&gt;\n";
	std::cout &lt;&lt; "\t\tWrite a 32-bit value to the specified address.\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "\tread &lt;address&gt;\n";
	std::cout &lt;&lt; "\t\tRead a 32-bit value from the specified decimal address.\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "\tfullwrite &lt;value&gt;\n";
	std::cout &lt;&lt; "\t\tFill the entire memory region with the specified 32-bit hex value.\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "\tfullread\n";
	std::cout &lt;&lt; "\t\tRead and display the entire memory region.\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "\thelp\n";
	std::cout &lt;&lt; "\t\tShow this help message.\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "\texit\n";
	std::cout &lt;&lt; "\t\tExit the program.\n\n";</span>

<span style = "background-color:#dfd">	std::cout &lt;&lt; "Address / Value format:\n";
	std::cout &lt;&lt; "\t&lt;address&gt; : Decimal integer (e.g., 16, 255)\n";
	std::cout &lt;&lt; "\t&lt;value&gt;   : 32-bit hexadecimal number\n";
	std::cout &lt;&lt; "\t\tMust start with '0x'\n";
	std::cout &lt;&lt; "\t\tMust contain exactly 8 hex digits (0-9, A-F)\n";
	std::cout &lt;&lt; "\t\tExample: 0x12345678, 0xDEADBEEF\n\n";
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>