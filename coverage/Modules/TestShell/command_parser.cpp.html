<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>command_parser.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include "command_parser.h"

#include &lt;sstream&gt;
#include &lt;iostream&gt;
#include &lt;regex&gt;

using std::istringstream;

void CommandParser::setCommand(const string&amp; command)
<span style = "background-color:#dfd">{
	this-&gt;commandStr = command;
	commandVector.clear();</span>

<span style = "background-color:#dfd">	istringstream ss{ commandStr };
	string strBuf;</span>

<span style = "background-color:#dfd">	while (getline(ss, strBuf, ' ')) {
		if (!strBuf.empty()) {
			commandVector.push_back(strBuf);</span>
		}
<span style = "background-color:#dfd">	}
}</span>

const std::vector&lt;std::string&gt;&amp; CommandParser::getCommandVector() const
<span style = "background-color:#fdd">{
	return commandVector;
}</span>

bool CommandParser::isValidCommand() const
<span style = "background-color:#dfd">{</span>
	try {
		// check parameter count
<span style = "background-color:#dfd">		if (commandVector.size() &lt; 1 || commandVector.size() &gt; 3) {
			return false;</span>
		}

		// check operation command
<span style = "background-color:#dfd">		string opCommand = commandVector.at(0);</span>

		// check valid commands
		if (opCommand != CMD_READ
			&amp;&amp; opCommand != CMD_WRITE
			&amp;&amp; opCommand != CMD_EXIT
			&amp;&amp; opCommand != CMD_HELP
			&amp;&amp; opCommand != CMD_FULLREAD
			&amp;&amp; opCommand != CMD_FULLWRITE
			&amp;&amp; opCommand != CMD_SCRIPT1
			&amp;&amp; opCommand != CMD_SCRIPT1_NAME
			&amp;&amp; opCommand != CMD_SCRIPT2
			&amp;&amp; opCommand != CMD_SCRIPT2_NAME
			&amp;&amp; opCommand != CMD_SCRIPT3
<span style = "background-color:#dfd">			&amp;&amp; opCommand != CMD_SCRIPT3_NAME) {
			return false;</span>
		}

		// check parameter count for each operation case
		if ((opCommand == CMD_READ &amp;&amp; commandVector.size() != 2) ||
			(opCommand == CMD_WRITE &amp;&amp; commandVector.size() != 3) ||
			(opCommand == CMD_EXIT &amp;&amp; commandVector.size() != 1) ||
			(opCommand == CMD_HELP &amp;&amp; commandVector.size() != 1) ||
			(opCommand == CMD_FULLREAD &amp;&amp; commandVector.size() != 1) ||
			(opCommand == CMD_FULLWRITE &amp;&amp; commandVector.size() != 2) ||
			((opCommand == CMD_SCRIPT1 || opCommand == CMD_SCRIPT1_NAME) &amp;&amp; commandVector.size() != 1) ||
<span style = "background-color:#dfd">			((opCommand == CMD_SCRIPT2 || opCommand == CMD_SCRIPT2_NAME) &amp;&amp; commandVector.size() != 1) ||</span>
			((opCommand == CMD_SCRIPT3 || opCommand == CMD_SCRIPT3_NAME) &amp;&amp; commandVector.size() != 1)) {
<span style = "background-color:#dfd">			return false;</span>
		}

		// check lba range
<span style = "background-color:#dfd">		if (opCommand == CMD_READ || opCommand == CMD_WRITE) {
			string lbaStr = commandVector.at(1);
			int lba = std::stoi(lbaStr);
			if (lba &lt; 0 || lba &gt; 99) {
				return false;</span>
			}
<span style = "background-color:#dfd">		}</span>

		// check value format
<span style = "background-color:#dfd">		if (opCommand == CMD_WRITE) {
			if (!isValidValue(commandVector.at(2))) {
				return false;</span>
			}
		}

<span style = "background-color:#dfd">		if (opCommand == CMD_FULLWRITE) {
			if (!isValidValue(commandVector.at(1))) {
				return false;</span>
			}
		}

<span style = "background-color:#dfd">		return true;</span>
	}
<span style = "background-color:#fdd">	catch (...) {
		return false;
	}</span>
<span style = "background-color:#dfd">}</span>

bool CommandParser::isValidValue(const string&amp; valueStr) const
<span style = "background-color:#dfd">{
	std::regex re("^0x[0-9A-F]{8}$");
	return std::regex_match(valueStr, re);
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>